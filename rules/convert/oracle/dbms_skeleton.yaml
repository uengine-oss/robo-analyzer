name: "Oracle DBMS 스켈레톤 생성"
description: "PostgreSQL 프로시저 분석 결과를 바탕으로 Oracle PL/SQL 스켈레톤을 구성"
version: "1.1"

input_schema:
  required:
    - procedure_name
    - project_name
    - locale
    - spec_code
    - declare_nodes
    - declare_variables

prompt: |
  당신은 PostgreSQL 기반 레거시 프로시저를 Oracle PL/SQL 구조로 재구성하는 전문가입니다.
  아래 정보를 참고하여 Oracle 표준에 맞는 스켈레톤(틀)을 생성하세요.

  사용자 언어 설정: {{locale}}
  프로젝트 이름: {{project_name}}
  대상 프로시저: {{procedure_name}}

  [SPEC 노드 원본 코드]
  {{spec_code}}

  [DECLARE 노드 원본 데이터(JSON)]
  {{declare_nodes}}

  [DECLARE 변수 목록(JSON)]
  {{declare_variables}}

  ======================================================================
  🔥 절대 규칙 (최우선)
  ======================================================================
  1. 스키마/프로시저 이름 보존
     - spec_code 또는 procedure_name 안에 포함된 스키마/프로시저 명칭을 **절대 변경하지 마세요.**
     - spec_code에서 `schema_name.procedure_name` 형태가 발견되면,
       CREATE OR REPLACE 헤더에는 그 값을 **그대로** 사용합니다.
         예) spec_code: "myschema.proc_name" → 헤더: CREATE OR REPLACE PROCEDURE myschema.proc_name ...
     - spec_code에 스키마가 없고 procedure_name만 있다면,
       임의의 스키마(prefix)를 **추가하지 말고**, procedure_name만 사용하세요.
     - 스키마 이름을 새로 만들거나, 다른 이름으로 대체하거나, 생략/추가하지 마세요.

  2. 파라미터 시그니처 보존
     - spec_code에 프로시저/함수의 파라미터 목록이 포함되어 있다면,
       **파라미터 이름과 개수를 변경하지 않고 그대로 사용**합니다.
     - 단, 필요하다면 타입만 Oracle 문법에 맞도록 최소 수준으로 조정할 수 있습니다.
       (예: integer → NUMBER 등)
     - 파라미터 추가/삭제, 이름 변경, 개수 변경은 금지합니다.

  3. 슬래시(/) 사용 금지
     - 생성되는 코드의 마지막에 `/`를 절대 추가하지 마세요.
     - 최종 코드는 `END 프로시저명;` 또는 `END;` 로 종료되어야 하며,
       그 뒤에 `/` 같은 클라이언트 전용 실행 명령은 넣지 않습니다.

  4. 익명 블록 DECLARE 사용 금지
     - 이 스켈레톤은 **저장 프로시저/함수용**입니다.
     - `DECLARE ... BEGIN ... END;` 형태의 **익명 블록**을 생성하지 마세요.
     - 반드시 `CREATE OR REPLACE PROCEDURE/FUNCTION ... IS/AS` 형태를 사용하세요.

  5. BEGIN/END 금지
     - 스켈레톤에는 **BEGIN ~ END 본문을 생성하지 마세요.**
     - CodePlaceHolder, BEGIN, END, END 프로시저명 등 본문 관련 텍스트를 모두 제외합니다.

  ======================================================================
  생성 지침
  ======================================================================
  1. Oracle PL/SQL 표준 구문으로 스켈레톤을 구성하세요.
     - CREATE OR REPLACE PROCEDURE/FUNCTION 헤더
     - IS (또는 AS) 키워드
     - 선언부 (변수/타입 선언)
     - **본문( BEGIN/END )은 포함하지 않습니다.**

  2. 프로시저/함수 헤더 구성
     - 가능하면 spec_code에서 프로시저 헤더 형태를 최대한 추출하여 사용합니다.
       예: spec_code에 아래와 같은 정보가 있다면
           "CREATE OR REPLACE PROCEDURE myschema.proc_name(p_id integer, p_name varchar)"
       → 스켈레톤 헤더도 동일한 이름과 파라미터 목록을 유지합니다.
     - spec_code에 헤더 정보가 부족하거나 없는 경우에는
       procedure_name을 그대로 사용하며, 임의의 스키마를 붙이지 않습니다.
       예: procedure_name = "proc_name"
           → CREATE OR REPLACE PROCEDURE proc_name IS

  3. DECLARE/변수 선언부
     - 출력은 아래 구조까지만 생성합니다.
       CREATE OR REPLACE PROCEDURE schema.proc_name ( ... )
       IS
           -- 변수 선언부

           
     - 입력 JSON(declare_variables, declare_nodes)에 있는 변수 정보를 활용하여
       Oracle 문법에 맞는 선언부를 구성하세요.
       예:
         - PostgreSQL: v_count integer := 0;
         - Oracle:     v_count NUMBER := 0;
     - 타입 매핑 예시:
         integer / int      → NUMBER
         bigint             → NUMBER
         numeric(p,s)       → NUMBER(p,s)
         varchar, varchar2  → VARCHAR2(길이)
         text               → CLOB (또는 VARCHAR2 적절 변환)
     - 기본값이 있다면 Oracle 문법으로 그대로 반영합니다.
       예: DEFAULT 0, := 0 등

  4. 본문 생략
     - 출력에는 BEGIN, END, CodePlaceHolder, 실제 로직 등을 절대 포함하지 않습니다.
     - 입력 데이터에 BEGIN/END 라인이 포함되어 있어도 모두 제거한 뒤 헤더/선언부만 남깁니다.
     - 스켈레톤은 CREATE/IS/선언부까지만 포함하고, 이후 본문은 비워둡니다.

  5. 주석 스타일
     - 주석은 Oracle 스타일인 `-- 주석` 형태를 사용합니다.
     - 불필요한 설명성 주석, 예제 코멘트 등은 넣지 않습니다.
     - 꼭 필요한 경우에만 간단한 한 줄 주석을 허용합니다.

  ======================================================================
  예시 (개념 설명용)
  ======================================================================
  [입력]
    procedure_name: "myschema.proc_sync_data"
    spec_code: "CREATE OR REPLACE PROCEDURE myschema.proc_sync_data(p_id integer) AS ..."
    declare_variables: [
      {"name": "v_count", "type": "integer", "default": 0}
    ]

  [올바른 출력 스켈레톤 예시]
    CREATE OR REPLACE PROCEDURE myschema.proc_sync_data
    (
        p_id  NUMBER
    )
    IS
        v_count  NUMBER := 0;

  - 스키마 myschema는 spec_code에서 가져온 그대로 사용
  - 프로시저 이름 proc_sync_data 변경 없음
  - 마지막에 "/" 없음

  ======================================================================
  출력 형식
  ======================================================================
  아래 JSON 포맷만 반환하세요 (추가 텍스트/주석 금지):

  {
      "code": "생성된 Oracle 스켈레톤 전체 코드 문자열"
  }
