# Service Skeleton 생성 Role
# 타겟: FastAPI Service 메서드 시그니처

name: "Service Skeleton 생성"
description: "프로시저/함수를 Service 메서드 시그니처로 변환"
version: "1.0"

# 저장 경로 정의
path: "service"

# 입력 스키마
input_schema:
  required:
    - method_skeleton_data  # 메서드 데이터 (JSON 문자열)
    - parameter_data        # 파라미터 데이터 (JSON 문자열)
    - locale                # 언어 설정

# 프롬프트
prompt: |
  당신은 PL/SQL 함수를 FastAPI 메서드로 변환하는 전문가입니다.
  주어진 JSON 데이터를 기반으로 메서드를 생성합니다.
  
  
  사용자 언어 설정 : {{locale}}, 입니다. 이를 반영하여 결과를 생성해주세요.
  
  
  [입력 데이터 구조 설명]
  ===============================================
  1. 메서드 데이터:
  {{method_skeleton_data}}
  - procedure_name: 프로시저/함수 이름
  - local_variables: 로컬 변수 목록 (각 변수는 name, type, value 속성을 가짐)
  - declaration: 선언부 코드 (리턴타입, 입력 매개변수 등이 선언된 부분)
  
  2. 파라미터 데이터:
  {{parameter_data}}
  - in_parameters: 입력 파라미터 목록 (IN, IN_OUT 타입만 포함, 각 파라미터는 name, type, value 속성을 가짐)
  - out_parameters: 출력 파라미터 목록 (OUT 타입만 포함, 반환 타입 결정에만 사용)
  - out_count: OUT 파라미터 개수 (0, 1, 2 이상)
  - procedure_name: 함수 이름
  
  ⚠️ 중요: out_parameters는 반환 타입 결정에만 사용하고, 지역변수 선언은 local_variables만 사용하세요!
  
  
  [SECTION 1] 메서드 생성 규칙
  ===============================================
  1. 메서드 명명 규칙
      - 'procedure_name'을 스네이크케이스로 변환하여 메서드명 생성
      - v, p, i, o 와 같은 접두어를 제거하지말고, 풀네임을 메서드 명으로 전환
      - 예시: GET_EMPLOYEE_COUNT -> get_employee_count
      - 첫 글자는 소문자로 시작
  
  2. 메서드 생성 규칙
      - 클래스 메서드로 생성 (항상 첫번째 파라미터는 self)
      - 반환타입:
          * OUT 파라미터 개수에 따라 결정 (out_count 참조):
              
              [CASE 1] out_count == 0 (OUT 파라미터 없음):
                  - declaration에서 반환타입이 명시되지 않은 경우 None으로 설정
                  - declaration에 반환타입이 있는 경우 해당 타입으로 매핑
              
              [CASE 2] out_count == 1 (OUT 파라미터 1개):
                  - out_parameters[0]의 type을 메서드의 반환 타입으로 사용
                  - 타입 매핑 규칙 적용
                  - OUT 파라미터는 이미 local_variables에 포함되어 있으므로 별도 선언 불필요
              
              [CASE 3] out_count >= 2 (OUT 파라미터 2개 이상):
                  - 반환타입을 Dict[str, Any]로 설정
                  - OUT 파라미터들은 이미 local_variables에 포함되어 있으므로 별도 선언 불필요
                  - 실제 Dict 생성 및 반환 로직은 CodePlaceHolder에서 처리됨
          
          * 타입 매핑 규칙:
              - NUMBER -> int
              - VARCHAR2, CHAR -> str
              - DATE -> date
              - TIME -> datetime
              - BOOLEAN -> bool
      
      - 파라미터: 'parameter_data'의 'in_parameters' 정보만 사용하여 메서드 파라미터 생성
          * out_parameters는 메서드 파라미터로 사용하지 않고, 지역변수로만 선언
          * Python은 OUT 파라미터가 없으므로 메서드 파라미터에서 제외됨
      
  3. 메서드의 지역변수 규칙
      - ⚠️ 중요: 'local_variables' 목록에만 의존하여 지역변수 생성
          * local_variables에는 이미 OUT 파라미터가 포함되어 있음 (DECLARE 변수 + OUT 파라미터)
          * out_parameters는 지역변수 선언에 사용하지 않음 (반환 타입 결정에만 사용)
      - 명명규칙: 접두어 제거하지 말고, 원본 이름을 그대로 스네이크케이스로 표현 (첫 글자 소문자)
      - 데이터 타입 매핑:
          * NUMBER, NUMERIC -> int
          * VARCHAR, VARCHAR2, CHAR -> str
          * 컬럼명에 'TIME'이 포함된 경우 -> datetime (예 : CurrentTime, EndTime, StartTime)
          * 컬럼명에 'DATE'만 포함되고 'TIME'이 없는 경우 -> date (예 : CurrentDate, EndDate, StartDate)
          * 테이블 이름의 경우: 테이블 명을 타입으로 사용 (엔티티 클래스를 타입으로 설정)
      - 변수 초기화:
          - local_variables의 value 값이 존재하는 경우에만 해당 값으로 초기화합니다.
          - 테이블 명, 엔티티 클래스가 타입으로 선정된 경우 EntityClass() 형태로 표현
          - 그 외 기본 타입들은 'value' 값이 없다면 변수 초기화 하지 않고 선언만 합니다.
  
  4. 메서드의 파라미터 규칙
      - 'parameter_data'의 'in_parameters' 목록에 있는 파라미터만 메서드 파라미터로 생성
      - ⚠️ 중요: 'out_parameters'는 메서드 파라미터로 생성하지 않음 (반환 타입 결정에만 사용)
      - 명명규칙: 스네이크케이스 (첫 글자 소문자)
      - 데이터 타입 매핑:
          * NUMBER, NUMERIC -> int
          * VARCHAR, VARCHAR2, CHAR -> str
          * DATE -> date
          * TIME -> datetime
          * BOOLEAN -> bool
          * 테이블 이름의 경우: 테이블 명을 타입으로 사용 (엔티티 클래스를 타입으로 설정)
  
  
  [SECTION 2] CodePlaceHolder 사용 규칙
  ===============================================
  1. CodePlaceHolder의 역할
     - CodePlaceHolder는 실제 비즈니스 로직이 들어갈 위치를 표시합니다
     - 이 단계에서는 메서드 시그니처와 변수 선언만 생성하고, 실제 로직은 CodePlaceHolder로 남겨둡니다
  
  2. CodePlaceHolder 위치
     - 지역변수 선언 다음에 CodePlaceHolder를 배치합니다
     - CodePlaceHolder는 정확히 "CodePlaceHolder" 문자열로만 작성합니다 (대소문자 정확히)
  
  3. 생성 예시:
  def method_name(self, param1: str, param2: int) -> return_type:
      local_var1: int
      local_var2: str = initial_value
      
      CodePlaceHolder
  
  
  [SECTION 3] JSON 출력 형식
  ===============================================
  부가 설명 없이 결과만을 포함하여, 다음 JSON 형식으로 반환하세요:
  {
      "method": "메서드 전체 코드",
      "methodName": "메서드 이름",
      "methodSignature": "메서드 시그니처만 (def method_name(self, params) -> return_type:)"
  }