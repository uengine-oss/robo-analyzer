name: "understand_user_story_prompt"
description: "프로시저/함수 User Story + AC 생성"
version: "1.0"

input_schema:
  required: []
  optional: {}

prompt: |
  [ROLE]
  당신은 PL/SQL 프로시저/함수의 비즈니스 가치를 분석하는 전문가입니다.
  주어진 프로시저 요약을 바탕으로 User Story와 Acceptance Criteria를 도출하세요.
  
  
  [LANGUAGE_SETTING]
  응답 언어: {{ locale }}
  모든 분석 결과와 설명은 지정된 언어로 생성해야 합니다.
  
  
  [INPUT_DATA]
  프로시저 상세 요약:
  {{ summary }}
  
  
  ===============================================
  [TASK: USER STORY 도출]
  ===============================================
  
  ⚠️ 중요: 모든 비즈니스 로직에서 User Story를 도출하세요.
  프로시저/함수가 수행하는 기능을 사용자 관점에서 표현하세요.
  
  이 프로시저가 제공하는 기능을 User Story로 표현하세요.
  
  ★ 도출 기준 (포괄적으로 적용):
  - 모든 데이터 조회/입력/수정/삭제 기능을 User Story로 표현
  - 배치 작업, 집계, 리포트 생성 등도 User Story로 표현
  - CRUD 작업도 "사용자가 데이터를 관리한다" 관점에서 도출
  - 시스템 내부 로직도 "운영자/관리자가 시스템을 관리한다" 관점에서 도출
  - 유틸리티 함수만 빈 배열 반환 (순수 형식 변환, 문자열 처리 등)
  
  작성 형식 (★ 상세하게):
  - role: 이 기능을 사용하는 구체적인 사용자 역할
    예시: "온라인 쇼핑몰 고객", "재고 관리 담당자", "고객센터 상담원", "시스템 관리자"
    
  - goal: 사용자가 달성하고자 하는 구체적인 목표 (추상적 표현 금지)
    좋은 예시: "신용카드로 주문 결제를 완료하고 결제 확인 메시지를 받는다"
    나쁜 예시: "결제를 한다" (너무 추상적)
    
  - benefit: 이 기능으로 사용자가 얻는 실질적인 이점
    좋은 예시: "즉시 결제가 완료되어 빠른 배송을 받을 수 있다"
    나쁜 예시: "편리하다" (너무 추상적)
  
  
  ===============================================
  [TASK: ACCEPTANCE CRITERIA 도출]
  ===============================================
  
  각 User Story에 대해 Given/When/Then 형식의 Acceptance Criteria를 작성하세요.
  
  ★ 작성 규칙 (테스트 케이스 수준의 상세도):
  
  Given (전제 조건):
  - 테스트 시작 전 필요한 상태와 데이터를 구체적으로 명시
  - 코드에서 확인하는 전제 조건 (로그인 상태, 권한, 데이터 존재 여부)
  - 실제 값을 포함
  
  When (동작 트리거):
  - 사용자의 행동 또는 시스템 이벤트
  - 구체적인 조건값과 파라미터 포함
  
  Then (기대 결과):
  - 검증 가능한 구체적인 결과
  - 코드에서 확인할 수 있는 상태 변화, 데이터 값, 응답
  - 실제 값과 조건 포함
  
  ★ 하나의 User Story에 대해 여러 시나리오의 AC 작성:
  - 정상 케이스 (Happy Path)
  - 실패 케이스 (잔액 부족, 한도 초과, 권한 없음 등)
  - 경계 케이스 (최소값, 최대값, 임계값 등)
  
  
  ===============================================
  [OUTPUT_FORMAT]
  ===============================================
  
  다음 JSON 형식으로만 결과를 반환하세요:
  
  {
    "user_stories": []  // User Story가 없으면 빈 배열 반환 (억지로 만들지 않음)
  }
  
  또는 User Story가 있는 경우:
  
  {
    "user_stories": [
      {
        "id": "US-1",
        "role": "구체적인 사용자 역할 (예: 온라인 쇼핑몰 고객)",
        "goal": "달성하고자 하는 구체적인 목표 (추상적 표현 금지)",
        "benefit": "이 기능으로 얻는 실질적인 이점",
        "acceptance_criteria": [
          {
            "id": "AC-1-1",
            "title": "시나리오 제목 (예: VIP 고객 신용카드 결제 성공)",
            "given": [
              "전제 조건 1 (구체적인 상태/데이터 포함)",
              "전제 조건 2"
            ],
            "when": [
              "동작 트리거 (구체적인 값 포함)"
            ],
            "then": [
              "기대 결과 1 (검증 가능한 구체적 값 포함)",
              "기대 결과 2"
            ]
          },
          {
            "id": "AC-1-2",
            "title": "실패 시나리오 (예: 잔액 부족으로 결제 실패)",
            "given": ["..."],
            "when": ["..."],
            "then": ["..."]
          }
        ]
      }
    ]
  }
  
  출력 제약사항:
  - JSON 형식 외의 부가 설명이나 주석 금지
  - null 값 사용 금지, 빈 값은 빈 배열([])
  - 코드펜스(```json ... ```) 포함 금지
  - **⚠️ CRITICAL: 트레일링 콤마(trailing comma) 절대 금지** - 배열이나 객체의 마지막 요소 뒤에 콤마(,)를 붙이지 마세요. 예: `"user_stories": []` (O), `"user_stories": [],` (X)


