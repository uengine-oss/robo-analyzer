name: "PostgreSQL 대용량 노드 Oracle 스켈레톤 생성"
description: "요약된 PostgreSQL 코드를 Oracle 제어구조 + DML 스켈레톤으로 변환"
version: "2.0"

input_schema:
  required:
    - summarized_code
    - locale

prompt: |
  ======================================================================
  🔥 목적 (핵심)
  ======================================================================
  입력으로 제공되는 요약본 PostgreSQL Stored Procedure 코드를 읽고,
  **현재 레벨(부모)의 제어구조 또는 DML 구조만 Oracle PL/SQL 스켈레톤으로 변환**하고  
  내부 로직(자식)은 모두 단 하나의 `...code...` 로 대체한 Oracle PL/SQL 골격을 생성합니다.

  이 단계는 “스켈레톤 생성 단계”이며 실제 로직 변환 단계가 아닙니다.

  출력물은 Oracle 문법 형태의 **구조만 나타내는 뼈대 코드**를 생성해야 합니다.


  ======================================================================
  ⚠️ 최우선 준수 규칙
  ======================================================================
  1) PostgreSQL 원본의 흐름·순서를 절대 변경하지 않는다  
  2) 현재 레벨(부모)만 Oracle 형태로 변환  
  3) 자식은 모두 `...code...` 1회로만 표현  
  4) 들여쓰기 유지  
  5) 문자열, 변수명, 조건문 내용 절대 변경 금지  
  6) 로직을 새로 창작하거나 최적화하지 말 것  
  7) 출력은 반드시 JSON 형식만 유지  
  8) 라인번호 제거  
     - `100: ... code ...` → `...code...`


  ======================================================================
  SECTION 1 — 부모/자식 구분 규칙
  ======================================================================
  ✔ 부모(현재 레벨) = 제어구조 헤더 / DML 문 헤더  
  ✔ 자식 = 해당 블록 내부의 모든 실제 실행문

  다음은 모두 “부모 레벨”에 해당하며, Oracle로 변환해야 한다:

  - IF / ELSIF / ELSE
  - CASE / WHEN
  - LOOP / FOR / WHILE
  - SELECT INTO의 “SELECT ... INTO ... FROM ...” 구조
  - INSERT / UPDATE / DELETE / MERGE 문
  - BEGIN / END 블록의 외곽 구조

  다음은 모두 “자식 레벨”이며 반드시 축약한다:

  - DML 내부의 실제 컬럼/값 나열
  - 복잡한 SELECT
  - 반복문/조건문 내부 상세 로직
  - 하위 블록 전체
  - 여러 줄의 code → 무조건 하나의 `...code...`


  ======================================================================
  SECTION 2 — 제어구조 변환 규칙
  ======================================================================
  PostgreSQL IF/ELSIF/ELSE → 동일한 Oracle IF/ELSIF/ELSE

  예)
      IF v_count = 0 THEN
          100: ... code ...
          101: ... code ...
      END IF;

  출력)
      IF v_count = 0 THEN
          ...code...
      END IF;

  규칙:
  - 조건식은 변경하지 않음
  - 내부 로직은 모두 `...code...` 1회만
  - 중첩 구조도 동일 규칙 적용


  ======================================================================
  SECTION 3 — DML 스켈레톤 변환 규칙 (핵심)
  ======================================================================

  PostgreSQL의 DML은 Oracle PL/SQL에서 문법이 다르므로  
  “골격 형태”를 Oracle 표준으로 정확히 변환해야 한다.

  아래는 모든 DML에 적용되는 공통 스켈레톤 규칙이다.


  -------------------------------------------------------
  1) INSERT 스켈레톤
  -------------------------------------------------------
  PostgreSQL:
      INSERT INTO users (id, name, email)
      VALUES (...);

  Oracle 스켈레톤 출력:
      INSERT INTO users
      (
          ...code...
      );

  또는 INSERT SELECT 형태라면:
      INSERT INTO users
      (
          ...code...
      )
      SELECT
          ...code...
      FROM ...code...;


  -------------------------------------------------------
  2) UPDATE 스켈레톤
  -------------------------------------------------------
  PostgreSQL:
      UPDATE users SET name = ... WHERE id = ...;

  Oracle 스켈레톤 출력:
      UPDATE users
         SET
             ...code...
       WHERE
             ...code...;


  -------------------------------------------------------
  3) DELETE 스켈레톤
  -------------------------------------------------------
  PostgreSQL:
      DELETE FROM users WHERE id = ...;

  Oracle 스켈레톤 출력:
      DELETE FROM users
       WHERE
             ...code...;


  -------------------------------------------------------
  4) SELECT INTO 스켈레톤
  -------------------------------------------------------
  PostgreSQL:
      SELECT col1, col2 INTO v1, v2 FROM table WHERE ...;

  Oracle 스켈레톤 출력:
      SELECT
          ...code...
        INTO
          ...code...
        FROM
          ...code...
       WHERE
          ...code...;


  -------------------------------------------------------
  5) UPDATE FROM (PostgreSQL 전용) → MERGE 스켈레톤
  -------------------------------------------------------
  PostgreSQL:
      UPDATE a
         SET x = b.x
        FROM b
       WHERE a.id = b.id;

  Oracle은 UPDATE FROM을 지원하지 않기 때문에  
  반드시 MERGE 스켈레톤으로 변환한다:

  Oracle 스켈레톤 출력:

      MERGE INTO a tgt
      USING (
          ...code...
      ) src
         ON (
              ...code...
         )
      WHEN MATCHED THEN
          UPDATE SET
              ...code...;


  -------------------------------------------------------
  6) MERGE 문 그대로 스켈레톤 처리
  -------------------------------------------------------
  PostgreSQL MERGE가 있다면:

  출력은 항상 Oracle MERGE 스켈레톤 형태:

      MERGE INTO target t
      USING (
          ...code...
      ) s
         ON (
              ...code...
         )
      WHEN MATCHED THEN
          UPDATE SET
              ...code...
      WHEN NOT MATCHED THEN
          INSERT
          (
              ...code...
          )
          VALUES
          (
              ...code...
          );


  ======================================================================
  SECTION 4 — BEGIN / END 블록 형식
  ======================================================================
  BEGIN
      ...code...
  END;

  또는 상위 조건 포함 시:

  IF condition THEN
      BEGIN
          ...code...
      END;
  END IF;


  ======================================================================
  SECTION 5 — ...code... 생성 규칙
  ======================================================================
  - 각 블록 내부에는 반드시 단 하나의 `...code...` 만 존재
  - 여러 줄 code라도 입력에서는 전부 무시 → 출력은 `...code...` 1줄
  - 라인번호 제거
    예: `101: ... code ...` → `...code...`
  - 들여쓰기 4 spaces 유지


  ======================================================================
  SECTION 6 — 예시 변환 종합
  ======================================================================
  입력:
      100: INSERT INTO users (id, name) VALUES (...);
      101: ... code ...
      102: ... code ...
      103: ;

  출력:
      INSERT INTO users
      (
          ...code...
      );


  입력:
      UPDATE table SET col = val FROM ...

  출력:
      MERGE INTO table t
      USING (
          ...code...
      ) s
         ON (
              ...code...
         )
      WHEN MATCHED THEN
          UPDATE SET
              ...code...;


  ======================================================================
  JSON 출력 형식
  ======================================================================
  {
      "code": "스켈레톤 Oracle 코드 문자열"
  }
