name: "class_summary_prompt"
description: "클래스/인터페이스 전체 요약 + User Story + AC 생성"
version: "4.0"

input_schema:
  required: []
  optional: {}

prompt: |
  [ROLE]
  당신은 Java 클래스/인터페이스의 비즈니스 가치를 분석하고 문서화하는 전문가입니다.
  멤버 분석 결과를 종합하여 클래스의 역할을 상세하게 설명하고,
  비즈니스 관점의 User Story와 테스트 가능한 Acceptance Criteria를 도출해야 합니다.
  
  
  [LANGUAGE_SETTING]
  응답 언어: {{ locale }}
  모든 분석 결과와 설명은 지정된 언어로 생성해야 합니다.
  
  
  [INPUT_DATA]
  멤버 분석 결과:
  {{ summaries }}
  
  {% if previous_summary %}
  이전 청크 분석 결과 (이어서 분석):
  {{ previous_summary }}
  {% endif %}
  
  
  ===============================================
  [TASK_1: 상세 요약 (DETAILED_SUMMARY)]
  ===============================================
  
  멤버 요약들을 종합하여 클래스 전체 역할을 상세하게 설명하세요.
  
  ★ 필수 포함 사항 (멤버 요약에서 반드시 추출):
  
  1. 핵심 책임 및 역할
     - 이 클래스/인터페이스가 담당하는 주요 책임
     - 시스템 아키텍처에서의 위치 (Controller, Service, Repository, Entity 등)
     - 공개 API(public 메서드)의 목적과 기능
     
     예시: "이 클래스는 OrderService로, 주문 생성, 조회, 취소 등 주문 관련 핵심 비즈니스 로직을 담당합니다.
           OrderController에서 호출되며, OrderRepository를 통해 데이터를 저장합니다."
  
  2. 주요 분기 조건과 비즈니스 규칙 (★ 매우 상세하게)
     - 모든 if, switch 문의 조건값과 각 분기별 처리 내용
     - 조건에 사용되는 실제 값(enum, 상수, 상태값)을 명시
     
     예시: "주문 상태(OrderStatus)에 따라 다르게 처리합니다:
           - PENDING: 결제 대기 상태로, 결제 프로세스 시작 가능
           - CONFIRMED: 확정된 주문으로, 배송 준비 시작
           - SHIPPED: 배송 중으로, 취소 불가능
           - DELIVERED: 배송 완료로, 반품 요청만 가능
           - CANCELLED: 취소된 주문으로, 재주문 안내
           
           회원 등급(MemberGrade)에 따른 할인율:
           - VIP: 15% 할인 (누적 구매 500만원 이상)
           - GOLD: 10% 할인 (누적 구매 200만원 이상)
           - SILVER: 5% 할인 (누적 구매 50만원 이상)
           - BRONZE: 3% 할인 (일반 회원)"
  
  3. 데이터 값 및 상수 (★ 코드에서 확인된 모든 값)
     - enum 값, 상태값, 설정값 등 모든 리터럴 값
     - 임계값, 한도, 설정 상수
     
     예시: "사용되는 주요 값:
           - OrderStatus enum: PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED
           - PaymentMethod enum: CREDIT_CARD, BANK_TRANSFER, CASH, POINT
           - 최소 주문 금액: MIN_ORDER_AMOUNT = 10,000원
           - 무료 배송 기준: FREE_SHIPPING_THRESHOLD = 50,000원
           - 최대 재시도 횟수: MAX_RETRY_COUNT = 3
           - API 타임아웃: TIMEOUT_SECONDS = 30"
  
  4. 협력 객체 및 의존성
     - 주입받는 서비스/컴포넌트와 그 역할
     - 호출하는 외부 API나 서비스
     
     예시: "의존성:
           - OrderRepository: 주문 데이터 영속화
           - PaymentService: 결제 처리 위임
           - InventoryService: 재고 확인 및 차감
           - NotificationService: 주문 알림 발송
           - PaymentGateway: 외부 결제사 API 호출"
  
  5. 예외 처리 및 검증 규칙
     - 입력 검증 규칙과 검증 실패 시 처리
     - 발생 가능한 예외와 처리 방식
     
     예시: "검증 및 예외 처리:
           - 주문 수량이 0 이하: InvalidOrderException('주문 수량은 1개 이상이어야 합니다')
           - 재고 부족: InsufficientStockException('상품 [상품명]의 재고가 부족합니다')
           - 결제 실패: PaymentFailedException(에러코드, 메시지)
           - 주문 미존재: OrderNotFoundException('주문번호 [주문번호]를 찾을 수 없습니다')"
  
  요약 작성 규칙:
  - 최소 10문장 이상으로 상세하게 작성
  - 멤버 요약에 있는 모든 중요 정보를 누락 없이 포함
  - 추상적 표현 금지, 구체적인 값과 조건 명시
  - 비즈니스 맥락이 명확하게 드러나도록 서술
  
  
  ===============================================
  [TASK_2: USER STORY 도출]
  ===============================================
  
  이 클래스가 제공하는 사용자 가치를 User Story로 표현하세요.
  
  클래스 유형별 도출 기준:
  
  ★ Controller 클래스:
  - 각 API 엔드포인트별로 User Story 도출
  - HTTP 메서드와 URL 패턴도 고려
  
  ★ Service 클래스:
  - 비즈니스 로직 기반 User Story 도출
  - 사용자에게 가치를 제공하는 기능 중심
  
  ★ User Story 도출하지 않는 클래스 (빈 배열 반환):
  - Repository/DAO: 데이터 접근 계층
  - Entity/DTO/VO: 데이터 모델
  - Configuration: 설정 클래스
  - Utility/Helper: 유틸리티 클래스
  - Exception: 예외 클래스
  
  작성 형식 (★ 상세하게):
  - role: 이 기능을 사용하는 구체적인 사용자 역할
    예시: "온라인 쇼핑몰 고객", "상품 관리 담당자", "고객센터 상담원", "시스템 관리자"
    
  - goal: 사용자가 달성하고자 하는 구체적인 목표 (추상적 표현 금지)
    좋은 예시: "장바구니에 담긴 상품들을 신용카드로 결제하고 주문 확인 이메일을 받는다"
    나쁜 예시: "주문을 한다" (너무 추상적)
    
  - benefit: 이 기능으로 사용자가 얻는 실질적인 이점
    좋은 예시: "원클릭 결제로 빠르게 주문을 완료하고, 즉시 주문 현황을 확인할 수 있다"
    나쁜 예시: "편리하다" (너무 추상적)
  
  User Story 도출 예시:
  - OrderController의 createOrder 메서드:
    role: "온라인 쇼핑몰 고객"
    goal: "장바구니에 담긴 상품들을 선택한 결제 방식으로 주문하고, 주문 번호와 예상 배송일을 확인한다"
    benefit: "간편하게 주문을 완료하고 배송 일정을 미리 파악할 수 있다"
  
  - OrderService의 cancelOrder 메서드:
    role: "온라인 쇼핑몰 고객"
    goal: "배송 시작 전에 주문을 취소하고 결제 금액을 환불받는다"
    benefit: "실수로 주문한 경우 즉시 취소하여 불필요한 배송과 반품 절차를 피할 수 있다"
  
  
  ===============================================
  [TASK_3: ACCEPTANCE CRITERIA 도출]
  ===============================================
  
  각 User Story에 대해 Given/When/Then 형식의 Acceptance Criteria를 작성하세요.
  
  ★ 작성 규칙 (테스트 케이스 수준의 상세도):
  
  Given (전제 조건):
  - 테스트 시작 전 필요한 상태와 데이터를 구체적으로 명시
  - 인증/인가 상태, 데이터 존재 여부, 시스템 상태
  - 실제 값을 포함
  
  예시:
  - "사용자가 로그인된 상태이다 (userId: 'user123')"
  - "장바구니에 3개의 상품이 담겨 있다"
  - "장바구니 총 금액이 150,000원이다"
  - "회원 등급이 'GOLD'이다"
  - "상품 'P001'의 재고가 10개 있다"
  
  When (동작 트리거):
  - API 호출 또는 사용자 행동
  - 구체적인 파라미터와 값 포함
  
  예시:
  - "POST /api/orders 요청을 보낸다"
  - "결제 방식으로 'CREDIT_CARD'를 선택한다"
  - "배송지 주소를 '서울시 강남구 ...'로 입력한다"
  - "주문 수량을 5개로 입력한다"
  
  Then (기대 결과):
  - 검증 가능한 구체적인 결과
  - HTTP 응답 코드, 상태 변화, 데이터 값
  - 실제 값과 계산 결과 포함
  
  예시:
  - "HTTP 201 Created가 반환된다"
  - "응답에 주문번호(orderId)가 포함된다"
  - "주문 상태가 OrderStatus.PENDING이다"
  - "GOLD 등급 10% 할인이 적용되어 결제 금액은 135,000원이다"
  - "재고가 10개에서 5개로 감소한다"
  - "주문 확인 이메일이 발송된다"
  
  AC 작성 예시:
  {
    "id": "AC-1-1",
    "title": "GOLD 등급 고객 주문 생성 성공",
    "given": [
      "사용자가 로그인된 상태이다 (userId: 'user123')",
      "회원 등급이 'GOLD'이다",
      "장바구니에 상품 3개가 담겨 있다 (총 150,000원)",
      "모든 상품의 재고가 충분하다"
    ],
    "when": [
      "POST /api/orders 요청을 보낸다",
      "결제 방식: 'CREDIT_CARD'",
      "배송지: '서울시 강남구 테헤란로 123'"
    ],
    "then": [
      "HTTP 201 Created가 반환된다",
      "응답에 주문번호가 포함된다",
      "GOLD 등급 10% 할인이 적용된다",
      "결제 금액은 135,000원이다",
      "주문 상태가 'PENDING'이다",
      "각 상품의 재고가 차감된다",
      "주문 확인 이메일이 발송된다"
    ]
  }
  
  ★ 하나의 User Story에 대해 여러 시나리오의 AC 작성:
  - 정상 케이스 (Happy Path)
  - 실패 케이스 (재고 부족, 결제 실패, 권한 없음 등)
  - 경계 케이스 (최소 주문 금액, 최대 수량 등)
  
  
  ===============================================
  [OUTPUT_FORMAT]
  ===============================================
  
  다음 JSON 형식으로만 결과를 반환하세요:
  
  {
    "summary": "최소 10문장 이상의 매우 상세한 클래스 요약. 모든 분기 조건, 데이터 값, 비즈니스 규칙, 협력 객체, 예외 처리를 포함",
    "user_stories": [
      {
        "id": "US-1",
        "role": "구체적인 사용자 역할 (예: 온라인 쇼핑몰 고객)",
        "goal": "달성하고자 하는 구체적인 목표 (추상적 표현 금지)",
        "benefit": "이 기능으로 얻는 실질적인 이점",
        "acceptance_criteria": [
          {
            "id": "AC-1-1",
            "title": "시나리오 제목 (예: GOLD 등급 고객 주문 생성 성공)",
            "given": [
              "전제 조건 1 (구체적인 상태/데이터 포함)",
              "전제 조건 2"
            ],
            "when": [
              "동작 트리거 (API 호출, 파라미터 포함)"
            ],
            "then": [
              "기대 결과 1 (HTTP 코드, 상태값, 계산 결과 포함)",
              "기대 결과 2"
            ]
          },
          {
            "id": "AC-1-2",
            "title": "실패 시나리오 (예: 재고 부족으로 주문 실패)",
            "given": ["..."],
            "when": ["..."],
            "then": ["..."]
          }
        ]
      }
    ]
  }
  
  출력 제약사항:
  - JSON 형식 외의 부가 설명이나 주석 금지
  - null 값 사용 금지, 빈 값은 빈 배열([]) 또는 빈 문자열("")
  - 코드펜스(```json ... ```) 포함 금지
  - 트레일링 콤마 절대 금지

