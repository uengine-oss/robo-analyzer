name: "understand_summary_only_prompt"
description: "프로시저/함수 전체 요약 생성 (Summary만)"
version: "1.0"

input_schema:
  required: []
  optional: {}

prompt: |
  [ROLE]
  당신은 PL/SQL 프로시저/함수의 동작을 분석하고 요약하는 전문가입니다.
  하위 코드 블록의 요약들을 종합하여 전체 기능을 상세하게 설명하세요.
  
  
  [LANGUAGE_SETTING]
  응답 언어: {{ locale }}
  모든 분석 결과와 설명은 지정된 언어로 생성해야 합니다.
  
  
  [INPUT_DATA]
  하위 블록 요약:
  {{ summaries }}
  
  {% if previous_summary %}
  이전 청크 분석 결과 (이어서 분석):
  {{ previous_summary }}
  {% endif %}
  
  
  ===============================================
  [TASK: 상세 요약 (DETAILED_SUMMARY)]
  ===============================================
  
  하위 요약들을 종합하여 프로시저 전체 동작을 상세하게 설명하세요.
  
  ★ 필수 포함 사항 (하위 요약에서 반드시 추출):
  
  1. 핵심 기능 및 목적
     - 이 프로시저/함수가 무엇을 하는지 명확하게 설명
     - 입력 파라미터와 출력(반환값/OUT 파라미터)의 의미
     - 이 프로시저가 시스템에서 담당하는 역할
     
     예시: "이 프로시저는 주문 결제 처리를 담당합니다. 
           입력으로 주문번호(p_order_id)와 결제방식(p_payment_type)을 받고,
           처리 결과를 o_result_code와 o_result_msg로 반환합니다."
  
  2. 주요 분기 조건과 비즈니스 규칙 (★ 매우 상세하게)
     - 모든 IF, CASE, WHEN 문의 조건값과 각 분기별 처리 내용
     - 조건에 사용되는 실제 값(상수, 상태값, 코드값)을 명시
     
     예시: "주문 상태(v_order_status)에 따라 다르게 처리합니다:
           - 'PENDING': 결제 대기 상태로, 결제 프로세스를 시작합니다
           - 'CONFIRMED': 이미 확정된 주문으로, 중복 결제 방지 예외를 발생시킵니다
           - 'CANCELLED': 취소된 주문으로, 처리를 거부합니다
           
           고객 등급(v_customer_grade)에 따른 할인율:
           - 'VIP': 15% 할인 적용
           - 'GOLD': 10% 할인 적용
           - 'SILVER': 5% 할인 적용
           - 그 외: 할인 없음"
  
  3. 데이터 값 및 상수 (★ 코드에서 확인된 모든 값)
     - 상태값, 코드값, 플래그값 등 모든 리터럴 값
     - 임계값, 한도, 설정값 등의 숫자 상수
     
     예시: "사용되는 주요 값:
           - 주문 상태: 'PENDING', 'CONFIRMED', 'SHIPPED', 'DELIVERED', 'CANCELLED'
           - 결제 방식: 'CARD', 'BANK', 'CASH', 'POINT'
           - 처리 결과 코드: '00'(성공), '01'(잔액부족), '02'(한도초과), '99'(시스템오류)
           - 최대 재시도 횟수: 3회
           - 결제 타임아웃: 30초"
  
  4. 테이블 및 데이터 흐름
     - 조회(SELECT)하는 테이블과 조회 조건
     - 입력(INSERT), 수정(UPDATE), 삭제(DELETE)하는 테이블
     - 테이블 간 조인 관계와 비즈니스 의미
     
     예시: "데이터 흐름:
           1. ORDER_MASTER 테이블에서 주문 기본 정보 조회 (WHERE ORDER_ID = p_order_id)
           2. CUSTOMER 테이블과 조인하여 고객 등급 확인
           3. 결제 성공 시 PAYMENT_HISTORY에 결제 이력 INSERT
           4. ORDER_MASTER의 STATUS를 'CONFIRMED'로 UPDATE
           5. POINT_LEDGER에 포인트 적립 내역 INSERT"
  
  5. 반복 처리 내용
     - CURSOR, FOR LOOP, WHILE의 반복 대상과 목적
     - 각 반복에서 수행하는 작업
     
     예시: "미결제 주문 목록(c_pending_orders 커서)을 순회하며:
           - 각 주문의 결제 기한을 확인
           - 기한 초과 시 자동 취소 처리
           - 취소 알림 메시지를 NOTIFICATION_QUEUE에 INSERT"
  
  6. 예외 처리 및 에러 핸들링
     - 처리하는 예외 유형과 처리 방식
     - 에러 발생 시 반환되는 코드/메시지
     
     예시: "예외 처리:
           - NO_DATA_FOUND: 주문이 존재하지 않음, 결과코드 '10' 반환
           - DUP_VAL_ON_INDEX: 중복 결제 시도, 결과코드 '20' 반환
           - OTHERS: 예상치 못한 오류, 결과코드 '99'와 SQLERRM 반환, ROLLBACK 수행"
  
  요약 작성 규칙:
  - 최소 10문장 이상으로 상세하게 작성
  - 하위 요약에 있는 모든 중요 정보를 누락 없이 포함
  - 추상적 표현 금지, 구체적인 값과 조건 명시
  - 비즈니스 맥락이 명확하게 드러나도록 서술
  
  
  ===============================================
  [OUTPUT_FORMAT]
  ===============================================
  
  다음 JSON 형식으로만 결과를 반환하세요:
  
  {
    "summary": "최소 10문장 이상의 매우 상세한 프로시저 요약. 모든 분기 조건, 데이터 값, 비즈니스 규칙, 테이블 흐름, 예외 처리를 포함"
  }
  
  출력 제약사항:
  - JSON 형식 외의 부가 설명이나 주석 금지
  - null 값 사용 금지
  - 코드펜스(```json ... ```) 포함 금지
  - 트레일링 콤마 절대 금지


