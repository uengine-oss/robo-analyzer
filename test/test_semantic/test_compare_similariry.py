import os
import sys
import numpy as np
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..')))
from semantic.vectorizer import vectorize_text

def cosine_similarity(v1, v2):
    dot_product = np.dot(v1, v2)
    norm_v1 = np.linalg.norm(v1)
    norm_v2 = np.linalg.norm(v2)
    return dot_product / (norm_v1 * norm_v2)

# 주어진 벡터를 numpy 배열로 변환
db_vector = np.array([float(x) for x in """-0.00973310973495245,0.05212192237377167,0.0866253525018692,-0.04562017694115639,0.019486283883452415,-0.04596340283751488,0.0016538314521312714,0.1167028546333313,0.010739712044596672,0.12626340985298157,0.12593139708042145,-0.027561839669942856,-0.008347772993147373,-0.007485116366297007,-0.00957691203802824,-0.010276813991367817,-0.0637996569275856,0.022100739181041718,-0.05371401831507683,-0.05270775407552719,0.08887965977191925,-0.05861853435635567,-0.07297233492136002,0.02816759981215,-0.0018980299355462193,-0.005181696265935898,0.034879814833402634,0.06816182285547256,0.009540395811200142,0.04175048694014549,-0.0021133709233254194,0.04173286259174347,0.01368370745331049,-0.07361143082380295,0.032278914004564285,-0.03509749472141266,-0.07625612616539001,0.02480405755341053,-0.009956011548638344,0.06996673345565796,0.009146814234554768,-0.06310498714447021,-0.050598613917827606,-0.025707056745886803,0.029873812571167946,0.05428718775510788,-0.03775569424033165,0.09577428549528122,-0.07138942182064056,0.010440648533403873,0.012424918822944164,0.12655404210090637,-0.030430929735302925,-0.07625355571508408,0.007119948510080576,-0.11119116842746735,0.0025583149399608374,0.005466872826218605,-0.048205483704805374,-0.07649719715118408,-0.04036588594317436,0.006332626100629568,-0.042655713856220245,-0.022901220247149467,0.047741152346134186,0.05348582938313484,0.05925465375185013,-0.025782616809010506,-0.01875322312116623,0.048043426126241684,-0.031200993806123734,0.0021596697624772787,-0.06198810040950775,-0.03968556970357895,-0.0844697579741478,-0.016182448714971542,-0.044385019689798355,-0.017693230882287025,-0.09556549787521362,-0.09404835850000381,0.06631287187337875,0.026328258216381073,-0.009203960187733173,-0.096446193754673,0.04138331487774849,-0.05450151115655899,-0.014778507873415947,-0.04551761969923973,0.028406057506799698,0.015034031122922897,0.10876594483852386,-0.003819379024207592,-0.07055701315402985,0.03754747658967972,-0.02125905081629753,-0.008063131012022495,-0.1154198944568634,0.005997887346893549,-0.0006165943923406303,-0.04534797742962837,-0.048796288669109344,0.07158172875642776,-0.07710288465023041,-0.0653938576579094,-0.07299886643886566,0.027809495106339455,0.08413826674222946,0.010931042023003101,0.0353238582611084,-0.008660415187478065,-0.0686715841293335,-0.022274717688560486,-0.021441103890538216,-0.016438240185379982,0.047072865068912506,0.03559808060526848,0.025794174522161484,0.09882592409849167,0.00575913256034255,-0.11286692321300507,0.04119438678026199,0.045883458107709885,-0.003884778590872884,0.016184264793992043,-0.0769023597240448,-0.08900552988052368,-0.011106057092547417,3.106828263145444e-33,-0.05343124270439148,-0.04135441407561302,0.004741498734802008,-0.022575415670871735,-0.0026114999782294035,0.036493752151727676,0.017375390976667404,0.020247984677553177,0.05782870948314667,-0.014261533506214619,-0.006916737649589777,-0.10959159582853317,-0.02128276601433754,-0.018820783123373985,0.03615998476743698,0.09812495112419128,-0.028552167117595673,-0.0037885236088186502,0.014203774742782116,0.12627416849136353,0.09002335369586945,-0.06465722620487213,0.02827361598610878,0.004284914117306471,0.023679479956626892,0.08270081877708435,-0.011316639371216297,0.06713374704122543,-0.10702163726091385,-0.013543501496315002,0.054433513432741165,-0.05611512064933777,0.0012880964204668999,-0.06605637818574905,-0.041762497276067734,-0.06314007937908173,0.026850802823901176,-0.017939047887921333,0.04172129184007645,-0.009708435274660587,-0.06004725769162178,-0.03152383863925934,0.066437728703022,-0.004884033929556608,-0.05228862911462784,-0.004713499452918768,-0.024028033018112183,0.01722327247262001,-0.020563088357448578,0.03968591243028641,0.004374939948320389,-0.007568296045064926,0.006448714062571526,-0.07816477864980698,0.048545848578214645,-0.027153944596648216,-0.06638399511575699,0.05304739996790886,-0.0007800764287821949,0.14429712295532227,0.041812714189291,-0.02307598665356636,-0.07352518290281296,-0.005997238680720329,-0.0447593629360199,0.0843207836151123,-0.041833922266960144,-0.0022459253668785095,0.09652464091777802,0.010712235234677792,-0.007994601503014565,0.05485333874821663,-0.003534903982654214,0.04396699741482735,0.028579633682966232,-0.051896803081035614,-0.03140250965952873,0.011693725362420082,0.06444163620471954,0.04795197397470474,-0.01770545169711113,0.049732889980077744,-0.020065302029252052,-0.06709890812635422,0.07332570105791092,0.03486676141619682,-0.008763425052165985,0.058762818574905396,-0.07287421077489853,-0.029895145446062088,0.030844097957015038,-0.08067276328802109,0.08148852735757828,0.005433783400803804,0.06506332010030746,-8.456050121070623e-33,-0.06715082377195358,0.13321992754936218,-0.00046172598376870155,-0.044819142669439316,-0.0049493154510855675,0.008649381808936596,0.022567948326468468,-0.08236751705408096,0.016874490305781364,0.01554273534566164,-0.05075304955244064,0.0029401942156255245,-0.019125448539853096,0.03672542795538902,0.0008507364545948803,0.05116710439324379,-0.0861048698425293,-0.006800767499953508,-0.039596300572156906,-0.04406693950295448,0.03354344889521599,0.13702507317066193,0.053828176110982895,0.02193976193666458,-0.019302086904644966,-0.06505569815635681,0.01200873777270317,0.034335315227508545,0.029891690239310265,-0.027903057634830475,-0.0260903500020504,0.04414646700024605,-0.037627413868904114,0.03976735845208168,-0.021522635594010353,-0.1124686673283577,-0.05226646736264229,-0.00950636062771082,-0.012171014212071896,0.030094007030129433,0.04147987440228462,0.00705256313085556,0.05012962967157364,-0.05869992822408676,-0.0043378607369959354,0.002022821456193924,0.016629567369818687,-0.06262312084436417,0.08518622815608978,-0.0498686283826828,0.06924670934677124,0.016956189647316933,0.018513208255171776,0.03107868693768978,-0.003212976735085249,0.02391856350004673,0.03190747648477554,0.0011506798909977078,-0.03198910132050514,-0.02901657111942768,-0.044644735753536224,-0.010193053632974625,0.01357563678175211,0.07691626995801926,-0.005974820349365473,0.004726559855043888,-0.005088407546281815,-0.021413307636976242,0.09819397330284119,-0.015159078873693943,-0.028849424794316292,-0.008545788936316967,-0.038381192833185196,0.009770302101969719,-0.02093256078660488,0.07044029980897903,-0.0723811686038971,0.09207283705472946,0.06241384148597717,0.04517558962106705,-0.032531432807445526,-0.05573273077607155,-0.04093503952026367,-0.044058553874492645,-0.03263085335493088,-0.1582225263118744,0.0083163445815444,0.009222115390002728,-0.03929822891950607,0.08348263055086136,-0.06648506224155426,0.00891302153468132,0.07039514929056168,0.04031116142868996,0.04000679403543472,-5.3468564686909303e-8,0.00853181816637516,-0.05672599375247955,0.05004376918077469,0.015578468330204487,0.03537452965974808,-0.04293227195739746,-0.004886983428150415,-0.020358160138130188,-0.05458640679717064,-0.019132038578391075,0.012931492179632187,0.0023673123214393854,-0.02664598636329174,0.016741793602705002,-0.04571032524108887,-0.017676537856459618,-0.015591751784086227,0.04638773575425148,-0.007622953969985247,-0.10470393300056458,0.08787097781896591,-0.022173253819346428,-0.1513330042362213,0.04394432157278061,-0.006575026549398899,-0.011764710769057274,0.03193329647183418,0.026969626545906067,0.00040724672726355493,-0.017869368195533752,0.06713538616895676,-0.08949752151966095,-0.0024756540078669786,0.017355382442474365,0.04855741560459137,-0.021868109703063965,-0.006396680139005184,0.02541535161435604,0.028546199202537537,0.05246882885694504,-0.06192229315638542,-0.07641306519508362,0.04836861789226532,0.01701800338923931,0.03186757490038872,-0.05069786310195923,-0.0446128286421299,-0.07234132289886475,-0.08404048532247543,-0.000922103994525969,0.055471111088991165,0.0404011569917202,-0.0680774599313736,-0.05225306376814842,-0.010896442458033562,0.03478115797042847,0.003619156079366803,-0.02602563053369522,-0.027368782088160515,-0.06115995720028877,0.05453905835747719,0.026517076417803764,-0.0026247890200465918,-0.04419177770614624""".split(',')])  # 너무 길어서 생략

# 검색 텍스트 벡터화
search_text = """TPX_UPDATE_SALARY 프로시저에서 결근(STATUS='AB') 상태인 정규직(REGULAR_YN='Y') 직원의 급여 차감 로직 차이 발생. 
기본급 1,000,000원 기준으로 Java는 50% 차감하여 500,000원, PLSQL은 10% 차감하여 900,000원으로 계산됨"""
search_vector = vectorize_text(search_text)

# 유사도 계산
similarity = cosine_similarity(search_vector, db_vector)
print(f"코사인 유사도: {similarity:.4f}")